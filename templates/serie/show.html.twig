{% extends 'base.html.twig' %}

{% block title %}{{ serie.nom }}{% endblock %}

{% block body %}
<main class="container my-5">

    <div class="comic-card mx-auto p-4 shadow-lg rounded-4">

        {# --- Titre de la série --- #}
        <h1 class="text-center comic-title mb-4">{{ serie.nom }}</h1>

        <div class="row align-items-start">

            {# --- Image de la série --- #}
            {% if serie.image %}
            <div class="col-12 col-md-4 text-center mb-4 mb-md-0 pe-md-4">
                <img src="{{ asset('uploads/' ~ serie.image) }}"
                     alt="{{ serie.nom }}"
                     class="img-fluid rounded comic-border cover-zoom"
                     style="max-height: 300px;">
            </div>
            {% endif %}

            {# --- Infos et description --- #}
            <div class="col-12 col-md-8">

                <div class="comic-bubble mb-3">
                    <strong>Nom :</strong> {{ serie.nom }}
                </div>

                <div class="comic-bubble mb-3">
                    <strong>Description :</strong><br>
                    {{ serie.description ?: 'Aucune description' }}
                </div>

                {# --- Boutons actions --- #}
                <div class="d-flex gap-2 flex-wrap mb-3">
                    <a href="{{ path('app_album_new', {'serie_id': serie.id}) }}" class="comic-action-btn flex-grow-1 text-center">
                        Ajouter un album
                    </a>
                    <a href="{{ path('app_serie_edit', {'id': serie.id}) }}" class="comic-action-btn flex-grow-1 text-center">
                        Modifier la série
                    </a>
                    {{ include('serie/_delete_form.html.twig', {
                        'button_label': 'Supprimer',
                        'button_class': 'comic-action-btn flex-grow-1 text-center'
                    }) }}
                    <a href="{{ path('app_serie_index') }}" class="comic-action-btn flex-grow-1 text-center">
                        Retour
                    </a>
                </div>

            </div>
        </div>
    </div>
</main>

{# --- Albums de la série triés par numéro --- #}
<div class="container mt-5">
    {% if serie.albums|length > 0 %}
        <div class="comic-bubble text-center mx-auto mb-3" 
             style="max-width: 300px; font-weight: bold; font-size: 1.25rem;
                    background-color: rgba(255, 255, 255, 0.98); border: 2px solid #000; border-radius: 0.5rem; 
                    box-shadow: 3px 3px 0 rgba(0,0,0,0.2); padding: 0.75rem 1rem;">
            Albums de la série
        </div>

        {% set sortedAlbums = serie.albums|sort((a, b) => a.numero <=> b.numero) %}

        <div class="row row-cols-1 row-cols-md-3 g-4 mt-2">
            {% for album in sortedAlbums %}
                <div class="col">
                    <div class="comic-card h-100 p-2">

                        {% if album.couverture %}
                            <div class="d-flex justify-content-center align-items-center mb-3" style="height: 250px;">
                                <img src="{{ asset('uploads/' ~ album.couverture) }}"
                                     class="img-fluid comic-border cover-zoom"
                                     alt="{{ album.titre }}"
                                     style="max-height: 250px; object-fit: contain;">
                            </div>
                        {% else %}
                            <div class="comic-bubble text-center d-flex align-items-center justify-content-center mb-2"
                                 style="height: 250px;">
                                Pas d'image
                            </div>
                        {% endif %}

                        <div class="comic-bubble mb-2 text-center">
                            <strong>{{ album.titre }}</strong>
                        </div>

                        <div class="comic-bubble mb-2 text-center">
                            N° {{ album.numero }}
                        </div>

                        <div class="comic-bubble mb-2 text-center">
                            Statut : 
                            {% if album.lu %}
                                ✅ <span class="text-success fw-bold">Lu</span>
                            {% else %}
                                ❌ <span class="text-danger fw-bold">Non lu</span>
                            {% endif %}
                        </div>

                        <div class="d-flex gap-2 flex-wrap justify-content-center mt-2">
                            <a href="{{ path('app_album_show', {'id': album.id}) }}" class="comic-action-btn flex-grow-1 text-center">Voir</a>
                            <a href="{{ path('app_album_edit', {'id': album.id}) }}" class="comic-action-btn flex-grow-1 text-center">Modifier</a>
                            <form method="post" action="{{ path('app_album_delete', {'id': album.id}) }}"
                                  onsubmit="return confirm('Voulez-vous vraiment supprimer cet album ?');"
                                  class="flex-grow-1">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ album.id) }}">
                                <button class="comic-action-btn w-100">Supprimer</button>
                            </form>
                        </div>

                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="comic-bubble text-center mx-auto mb-3" 
             style="max-width: 300px; font-weight: bold; font-size: 1.25rem;
                    background-color: rgba(255, 255, 255, 0.98); border: 2px solid #000; border-radius: 0.5rem; 
                    box-shadow: 3px 3px 0 rgba(0,0,0,0.2); padding: 0.75rem 1rem;">
            Aucun album dans cette série
        </div>
    {% endif %}
</div>

{% endblock %}
