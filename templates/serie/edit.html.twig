{% extends 'base.html.twig' %}

{% block title %}Modifier la série{% endblock %}

{% block body %}
<main class="container my-5">

    <div class="comic-card mx-auto p-4 shadow-lg rounded-4" style="max-width: 700px;">

        <h1 class="comic-title text-center mb-4">
            Modifier la série
        </h1>

        {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}

        {# --- Nom de la série --- #}
        <div class="comic-bubble mb-3">
            {{ form_label(form.nom, null, {'label_attr': {'class': 'fw-bold'}}) }}
            {{ form_widget(form.nom, {'attr': {'class': 'form-control mt-2'}}) }}
            {{ form_errors(form.nom) }}
        </div>

        {# --- Description --- #}
        <div class="comic-bubble mb-3">
            {{ form_label(form.description, null, {'label_attr': {'class': 'fw-bold'}}) }}
            {{ form_widget(form.description, {'attr': {'class': 'form-control mt-2', 'rows': 4}}) }}
            {{ form_errors(form.description) }}
        </div>

        {# --- Image actuelle / nouvelle image --- #}
        <div class="comic-bubble mb-3 text-center">
            {% if serie.image %}
                <strong class="d-block mb-2">Image actuelle</strong>
                <img id="previewImage" src="/uploads/{{ serie.image }}" alt="Image actuelle"
                     class="img-fluid mt-2" style="max-height: 150px;">
            {% else %}
                <img id="previewImage" src="#" alt="Prévisualisation"
                     class="img-fluid mt-2" style="display:none; max-height: 150px;">
            {% endif %}
        </div>

        <div class="comic-bubble mb-3">
            {{ form_label(form.image, null, {'label_attr': {'class': 'fw-bold'}}) }}
            {{ form_widget(form.image, {'attr': {'class': 'form-control mt-2', 'id': 'serie_image_input', 'accept': 'image/*'}}) }}
            {{ form_errors(form.image) }}
            <div id="fileName" class="mt-1" style="font-style: italic; color:#555;"></div>
        </div>

        {# --- Boutons alignés sur la même ligne --- #}
        <div class="d-flex gap-2 flex-wrap mt-4 align-items-center">
            <button type="submit" class="comic-action-btn">Mettre à jour</button>
            <a href="{{ path('app_serie_index') }}" class="comic-action-btn">Retour</a>
            <form method="post"
                  action="{{ path('app_serie_delete', {'id': serie.id}) }}"
                  onsubmit="return confirm('Supprimer cette série ?');"
                  class="m-0">
                <button class="comic-action-btn text-danger" type="submit">Supprimer</button>
            </form>
        </div>

        {{ form_end(form) }}

    </div>
</main>

{# --- Script pour prévisualisation image --- #}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('serie_image_input');
    const preview = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');

    if (!input) return;

    input.addEventListener('change', () => {
        const file = input.files[0];

        if (!file) {
            preview.style.display = 'none';
            preview.src = '';
            fileName.textContent = '';
            return;
        }

        fileName.textContent = `Fichier sélectionné : ${file.name}`;

        const reader = new FileReader();
        reader.onload = e => {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    });
});
</script>

{% endblock %}
