{% extends 'base.html.twig' %}

{% block title %}Nouvelle série{% endblock %}

{% block body %}
<main class="container my-5">

    <div class="comic-card mx-auto p-4 shadow-lg rounded-4">

        <h1 class="comic-title text-center mb-4">Nouvelle série</h1>

        {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}

        {# --- Nom --- #}
        <div class="comic-bubble mb-3">
            {{ form_label(form.nom, null, {'label_attr': {'class': 'fw-bold'}}) }}
            {{ form_widget(form.nom, {'attr': {'class': 'form-control mt-2'}}) }}
            {{ form_errors(form.nom) }}
        </div>

        {# --- Description --- #}
        <div class="comic-bubble mb-3">
            {{ form_label(form.description, null, {'label_attr': {'class': 'fw-bold'}}) }}
            {{ form_widget(form.description, {'attr': {'class': 'form-control mt-2', 'rows': 4}}) }}
            {{ form_errors(form.description) }}
        </div>

        {# --- Image avec prévisualisation --- #}
        <div class="comic-bubble mb-3">
            {{ form_label(form.image, null, {'label_attr': {'class': 'fw-bold'}}) }}
            {{ form_widget(form.image, {'attr': {'class': 'form-control mt-2', 'id': 'serie_image_input', 'accept': 'image/*'}}) }}
            {{ form_errors(form.image) }}

            <img id="previewImage" alt="Miniature image" class="img-fluid mt-2" style="display:none; max-height:150px;">
            <div id="fileName" class="mt-1" style="font-style: italic; color:#555;"></div>
        </div>

        {# --- Boutons --- #}
        <div class="d-flex gap-2 flex-wrap mt-4">
            <button type="submit" class="comic-action-btn">Créer</button>
            <a href="{{ path('app_serie_index') }}" class="comic-action-btn">Retour</a>
        </div>

        {{ form_end(form) }}

    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('serie_image_input');
    const preview = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');

    if (!input || !preview) return;

    input.addEventListener('change', () => {
        const file = input.files[0];
        if (!file) {
            preview.style.display = 'none';
            preview.src = '';
            fileName.textContent = '';
            return;
        }

        fileName.textContent = `Fichier sélectionné : ${file.name}`;

        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    });
});
</script>
{% endblock %}
